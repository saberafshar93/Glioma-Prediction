<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRI Tumor Detection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        #preview {
            max-width: 100%;
            margin-top: 20px;
        }
        #result {
            margin-top: 20px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>MRI Tumor Detection</h1>
    <p>Upload an MRI image to detect the type of tumor.</p>
    
    <!-- ورودی فایل -->
    <input type="file" id="fileInput" accept="image/*">
    
    <!-- نمایش تصویر آپلود شده -->
    <div>
        <img id="preview" src="#" alt="Image Preview" style="display:none;">
    </div>
    
    <!-- نمایش نتیجه -->
    <div id="result"></div>

    <!-- بارگذاری TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script>
        // بارگذاری مدل از پیش آموزش‌دیده (مثال: MobileNet)
        async function loadModel() {
            const model = await tf.loadLayersModel('https://tfhub.dev/google/tfjs-model/imagenet/mobilenet_v2_100_224/classification/4/default/1');
            return model;
        }

        // پیش‌بینی روی تصویر آپلود شده
        async function predict(imageElement) {
            const model = await loadModel();
            const tensor = tf.browser.fromPixels(imageElement)
                .resizeNearestNeighbor([224, 224]) // تغییر اندازه تصویر به اندازه مدل
                .toFloat()
                .expandDims();

            const predictions = await model.predict(tensor);
            const result = predictions.dataSync(); // دریافت نتایج
            return result;
        }

        // نمایش تصویر آپلود شده و انجام پیش‌بینی
        const fileInput = document.getElementById('fileInput');
        const previewImg = document.getElementById('preview');
        const resultDiv = document.getElementById('result');

        fileInput.addEventListener('change', async function() {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';

                    // انجام پیش‌بینی پس از بارگذاری تصویر
                    previewImg.onload = async function() {
                        const predictions = await predict(previewImg);
                        resultDiv.innerText = `Predictions: ${predictions}`;
                    };
                };
                reader.readAsDataURL(file);
            } else {
                previewImg.style.display = 'none';
                resultDiv.innerText = '';
            }
        });
    </script>
</body>
</html>